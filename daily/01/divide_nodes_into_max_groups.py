# 30/1/25
# https://leetcode.com/problems/divide-nodes-into-the-maximum-number-of-groups/description/

# Start at an indegree of 0 & perform a BFS. Track the # levels. Return -1 if two elements in the
# same level are neighbours. Perform this for all connected graphs, and return the maximum.

from collections import deque, defaultdict

def magnificentSets(n: int, edges: list[list[int]]):
    g = [[] for _ in range(n + 1)]
    in_degree = [0 for _ in range(n + 1)]

    # Creating the adj-list representation of the Graph & determining
    # the in-degree for each node.
    for v, w in edges:
        g[v].append(w)
        g[w].append(v)

        in_degree[v] += 1
        in_degree[w] += 1

    # Sort the nodes by in_degree, and remove 0-node.
    in_degree = sorted(enumerate(in_degree), key=lambda x: x[1])

    # print(in_degree[0])
    in_degree = in_degree[1:]

    def BFS(root: int) -> int:
        visited = [False for _ in range(n + 1)]
        node_level = defaultdict(lambda: -1)

        q = deque([(root, 1)])
        node_level[root] = 1
        visited[root] = global_visited[root] = True

        farthest_v, maxx = root, 0
        while q:
            v, lvl = q.popleft()

            # Store the highest lvl.
            maxx = max(maxx, lvl)
            farthest_v = v

            for neighbour in g[v]:
                # Found a contradiciton -- that is, two neighbours have the SAME
                # node level.
                if node_level[neighbour] == node_level[v]:
                    return 0, None

                if visited[neighbour]:
                    continue

                q.append((neighbour, lvl + 1))
                node_level[neighbour] = lvl + 1

                visited[neighbour] = global_visited[neighbour] = True

        return maxx, farthest_v

    global_visited = [False for _ in range(n + 1)]

    maxx = 0
    for (node, in_deg) in in_degree:
        if global_visited[node]:
            continue
        
        if in_deg == 0:
            maxx += 1
            continue
        
        _, farthest_v = BFS(node)

        if not farthest_v:
            return -1

        local_max, _ = BFS(farthest_v)

        maxx += local_max
    
    return maxx

# print(magnificentSets(6, [[1,2],[1,4],[1,5],[2,6],[2,3],[4,6]]))
# print(magnificentSets(3, [[1,2],[2,3],[3,1]]))
# print(magnificentSets(92, [[67,29],[13,29],[77,29],[36,29],[82,29],[54,29],[57,29],[53,29],[68,29],[26,29],[21,29],[46,29],[41,29],[45,29],[56,29],[88,29],[2,29],[7,29],[5,29],[16,29],[37,29],[50,29],[79,29],[91,29],[48,29],[87,29],[25,29],[80,29],[71,29],[9,29],[78,29],[33,29],[4,29],[44,29],[72,29],[65,29],[61,29]]))
# print(magnificentSets(448, [[366,183],[81,44],[242,91],[69,97],[39,373],[391,386],[342,349],[136,229],[393,386],[60,185],[225,437],[168,138],[408,238],[162,403],[294,401],[171,356],[248,194],[152,241],[393,44],[399,105],[139,420],[343,241],[122,239],[31,239],[303,185],[292,260],[19,271],[389,410],[212,83],[219,44],[393,335],[68,62],[417,118],[150,437],[200,183],[257,359],[329,426],[265,367],[126,1],[261,416],[385,280],[200,359],[3,50],[11,52],[269,349],[18,412],[343,107],[76,437],[35,436],[336,437],[155,97],[78,377],[448,359],[155,52],[351,214],[400,367],[253,44],[102,214],[218,4],[6,91],[10,412],[323,107],[294,44],[395,236],[87,185],[115,447],[100,386],[169,194],[103,284],[126,44],[413,377],[64,185],[305,44],[216,239],[414,128],[249,183],[191,426],[28,412],[299,398],[440,235],[307,183],[145,52],[405,118],[264,410],[279,235],[181,437],[102,236],[22,118],[347,105],[325,437],[423,284],[80,273],[66,401],[161,377],[208,50],[207,280],[199,128],[246,1],[12,111],[16,50],[49,412],[414,412],[39,330],[429,430],[269,386],[18,214],[421,425],[422,4],[249,430],[264,273],[78,436],[21,284],[136,238],[90,194],[289,62],[414,185],[427,52],[39,258],[35,107],[301,185],[422,436],[75,377],[6,398],[159,262],[413,91],[314,105],[176,280],[289,105],[384,182],[193,29],[211,83],[66,425],[421,416],[148,398],[37,238],[181,403],[351,280],[129,403],[448,273],[299,258],[222,386],[247,4],[269,83],[33,349],[78,118],[353,280],[340,185],[360,352],[438,194],[99,335],[396,235],[152,441],[424,373],[174,214],[133,62],[166,280],[237,436],[253,50],[247,260],[247,436],[256,183],[147,398],[134,97],[25,229],[146,183],[102,352],[225,241],[331,426],[444,252],[369,401],[46,262],[274,52],[244,62],[423,241],[440,252],[60,426],[201,335],[47,386],[186,91],[344,4],[38,107],[66,239],[43,107],[35,430],[443,280],[30,107],[131,273],[108,425],[181,116],[417,138],[86,52],[364,62],[317,425],[248,367],[379,359],[47,349],[206,91],[237,349],[165,236],[339,262],[384,185],[75,367],[3,271],[149,401],[294,447],[19,437],[53,403],[245,52],[122,29],[19,273],[365,236],[247,194],[5,441],[96,236],[78,403],[45,235],[266,128],[197,214],[336,118],[78,175],[303,50],[378,441],[152,97],[16,229],[434,52],[74,401],[248,138],[376,367],[297,138],[353,412],[311,273],[66,273],[257,116],[165,352],[302,284],[327,359],[161,420],[370,425],[202,116],[23,83],[203,386],[163,83],[32,447],[160,252],[209,377],[360,398],[19,138],[369,284],[220,280],[17,284],[395,105],[303,214],[423,430],[72,447],[173,436],[409,52],[427,1],[106,349],[390,403],[435,412],[104,111],[332,280],[316,52],[380,352],[154,386],[86,280],[133,373],[47,377],[45,330],[347,416],[207,138],[281,401],[43,425],[77,367],[332,105],[427,105],[264,118],[46,138],[421,97],[230,398],[139,91],[184,183],[328,128],[439,105],[31,398],[165,425],[31,241],[369,118],[147,447],[340,373],[37,349],[146,359],[96,349],[306,238],[443,29],[117,97],[5,262],[396,91],[86,194],[223,386],[423,4],[79,1],[106,183],[365,349],[360,426],[112,185],[203,236],[165,403],[169,175],[342,377],[43,138],[342,214],[101,284],[148,238],[247,118],[197,420],[15,356],[161,185],[313,416],[3,410],[409,273],[134,4],[369,437],[215,50],[207,359],[215,377],[16,105],[67,349],[267,182],[270,356],[283,352],[226,1],[405,183],[414,335],[17,436],[318,386],[192,97],[411,447],[156,377],[413,425],[160,425],[317,358],[371,91],[320,105],[432,189],[253,236],[147,273],[85,1],[347,330],[270,29],[2,377],[342,138],[207,358],[103,386],[20,280],[121,111],[302,356],[331,1],[366,398],[331,194],[147,252]]))
# print(magnificentSets(500, [[130,463],[112,242],[119,96],[358,242],[496,310],[23,313],[196,50],[82,235],[199,249],[93,303],[436,357],[220,416],[220,282],[222,105],[67,110],[107,455],[339,288],[211,47],[453,350],[76,336],[2,372],[464,229],[301,149],[305,297],[192,234],[304,403],[335,228],[479,98],[109,260],[250,175],[126,204],[305,149],[404,449],[453,331],[164,113],[92,414],[337,396],[45,94],[382,132],[274,310],[86,239],[114,336],[3,178],[401,252],[130,329],[104,299],[437,200],[118,375],[306,495],[159,498],[70,441],[335,1],[128,72],[349,228],[423,200],[129,312],[188,224],[274,486],[255,372],[250,495],[148,1],[258,83],[315,379],[382,96],[104,31],[305,498],[28,375],[385,498],[82,303],[277,178],[210,35],[133,455],[166,276],[70,235],[108,386],[491,232],[4,434],[307,449],[334,406],[144,228],[93,134],[88,95],[399,111],[188,319],[436,131],[429,217],[123,432],[194,403],[167,329],[456,435],[483,471],[77,492],[205,445],[392,29],[156,102],[311,152],[413,48],[413,486],[400,347],[205,472],[226,229],[143,231],[190,127],[428,490],[130,53],[183,495],[55,41],[392,312],[188,405],[240,234],[454,101],[415,131],[318,53],[155,135],[398,299],[141,252],[328,163],[141,340],[215,100],[21,230],[248,270],[280,411],[82,442],[244,476],[221,121],[237,449],[193,84],[341,31],[301,430],[473,27],[366,1],[24,469],[318,235],[26,234],[415,217],[496,52],[118,135],[16,486],[153,346],[465,312],[2,135],[215,480],[157,229],[325,344],[401,356],[497,414],[92,283],[154,10],[58,441],[220,152],[410,62],[263,152],[124,31],[453,247],[385,217],[226,72],[11,369],[213,260],[311,90],[306,262],[5,83],[390,310],[209,242],[44,224],[24,345],[248,412],[144,303],[69,472],[427,239],[404,262],[161,233],[465,136],[126,347],[99,378],[374,361],[40,403],[366,17],[139,27],[92,29],[9,101],[362,180],[157,357],[307,13],[333,146],[339,36],[4,490],[18,176],[284,149],[349,115],[272,402],[333,383],[245,345],[280,266],[133,452],[170,452],[118,319],[315,96],[156,233],[400,313],[92,488],[380,260],[222,121],[285,56],[398,476],[328,247],[421,338],[213,422],[70,25],[196,152],[371,33],[243,350],[267,389],[332,455],[380,29],[304,269],[348,405],[243,111],[240,22],[191,102],[407,403],[447,10],[191,445],[120,409],[484,140],[487,95],[267,458],[58,347],[209,132],[77,452],[456,340],[141,266],[20,320],[182,132],[399,345],[164,136],[18,357],[45,200],[453,367],[295,278],[104,224],[154,297],[301,494],[148,10],[274,416],[243,80],[174,345],[169,357],[51,90],[365,91],[371,414],[349,369],[253,282],[291,71],[65,297],[7,232],[93,367],[453,300],[334,441],[166,41],[82,131],[241,282],[43,95],[279,266],[192,361],[265,64],[18,482],[374,135],[192,260],[393,405],[291,74],[456,74],[444,340],[317,378],[368,376],[474,350],[315,283],[408,233],[60,356],[447,346],[250,411],[129,430],[160,416],[116,452],[464,122],[451,117],[210,329],[251,445],[358,452],[421,442],[365,266],[219,346],[156,135],[202,178],[129,115],[168,34],[223,249],[75,498],[496,386],[373,50],[119,288],[189,132],[451,68],[169,452],[18,321],[155,330],[24,10],[161,110],[130,356],[390,450],[485,426],[92,432],[211,31],[118,406],[54,488],[384,422],[444,299],[362,397],[238,450],[428,249],[177,471],[28,327],[306,72],[104,13],[162,327],[420,113],[129,411],[295,175],[182,282],[371,375],[478,375],[201,396],[143,10],[40,494],[18,471],[496,482],[21,282],[7,426],[348,41],[197,25],[485,180],[157,127],[371,13],[32,494],[390,313],[352,13],[364,232],[4,449],[153,350],[382,1],[215,372],[82,146],[400,432],[144,12],[46,235],[284,91],[257,299],[433,158],[38,375],[193,262],[169,122],[174,149],[238,262],[139,113],[393,100],[421,435],[246,56],[382,445],[243,31],[477,83],[457,310],[4,406],[123,414],[399,249],[197,402],[86,278],[23,288],[268,136],[203,140],[112,455],[144,416],[144,89],[93,467],[284,466],[212,136],[302,100],[26,288],[491,381],[227,163],[314,439],[272,389],[126,283],[349,494],[318,493],[40,283],[76,22],[354,434],[126,330],[227,12],[218,56],[125,62],[478,231],[359,78],[444,376],[384,146],[410,409],[14,472],[419,293],[294,450],[410,351],[182,299],[354,414],[194,25],[481,379],[315,310],[337,472],[325,140],[274,449],[464,131],[285,330],[125,319],[192,15],[170,91],[194,344],[241,327],[421,249],[243,406],[496,262],[30,98],[277,98],[315,110],[436,110],[268,283],[59,471],[250,68],[203,56],[124,406],[199,171],[428,351],[358,340],[97,347],[360,441],[240,330],[496,115],[188,342],[334,121],[87,68],[425,34],[128,214],[481,235],[267,297],[168,270],[400,452],[69,492],[287,386],[168,81],[216,276],[407,68],[419,494],[142,449],[192,321],[77,249],[258,440],[365,12],[220,29],[294,269],[14,132],[126,176],[265,276],[67,445],[365,72],[69,445],[104,235],[150,283],[187,33],[343,405],[92,80],[399,372],[199,52],[296,494],[251,158],[429,282],[413,113],[42,131],[479,297],[177,282],[125,1],[153,445],[150,135],[32,239],[226,493],[481,13],[37,180],[382,110],[86,47],[185,446],[151,346],[443,121],[169,217],[292,172],[216,297],[268,105],[334,262],[355,495],[309,47],[26,48],[108,409],[444,372],[298,331],[32,442],[314,336],[337,89],[170,39],[373,19],[325,367],[120,310],[317,105],[87,89],[410,482],[42,136],[461,297],[87,122],[185,102],[470,432],[243,327],[433,71],[395,29],[189,486],[423,91],[160,269],[142,293],[385,147],[309,6],[196,480],[410,249],[219,297],[148,83],[419,62],[112,214],[250,231],[279,312],[248,282],[49,135],[267,283],[124,81],[387,449],[8,278],[66,78],[137,111],[433,131],[97,56],[82,39],[65,351],[298,235],[144,463],[167,347],[67,432],[273,72],[139,249],[227,500],[99,180],[142,110],[75,448],[301,403],[42,319],[438,321],[453,449],[415,68],[186,33],[309,486],[14,414],[123,327],[161,247],[421,500],[314,488],[474,260],[264,446],[46,434],[155,482],[294,330],[333,184],[7,476],[142,338],[304,377],[114,105],[413,163],[243,1],[496,442],[407,53],[305,72],[322,270],[365,327],[114,113],[66,252],[190,214],[387,78],[339,214],[391,434],[8,101],[250,72],[368,269],[173,445],[189,35],[219,33],[23,472],[306,53],[273,312],[352,389],[197,172],[112,135],[366,350],[130,207],[253,72],[368,448],[193,375],[43,455],[294,411],[23,47],[457,230],[209,147],[199,232],[318,256],[280,440],[306,330],[221,224],[428,41],[40,33],[246,25],[267,434],[279,48],[153,376],[190,458],[77,266],[473,452],[215,369],[436,31],[220,117],[481,389],[202,440],[461,13],[305,117],[359,282],[399,377],[69,350],[427,469],[349,163],[274,1],[251,297],[307,19],[197,493],[408,414],[245,214],[170,236],[279,499],[415,27],[322,259],[18,450],[265,480],[69,27],[272,426],[420,377],[363,320],[380,329],[173,452],[325,275],[69,344],[272,236],[106,135],[144,293],[133,449],[385,300],[208,35],[44,439],[215,122],[289,346],[66,266],[388,449],[219,330],[92,466],[292,338],[187,13],[349,500],[355,367],[388,361],[391,490],[254,48],[106,111],[443,409],[462,200],[392,426],[366,47],[302,440],[154,340],[415,242],[153,122],[285,320],[193,6],[474,71],[400,275],[388,13],[93,41],[123,319],[221,29],[483,377],[222,184],[251,422],[360,206],[67,467],[195,405],[419,256],[433,275],[360,405],[154,469],[401,351],[160,495],[417,329],[107,228],[286,455],[123,22],[271,441],[339,91],[311,476],[491,224],[126,71],[292,375],[429,17],[189,375],[156,110],[456,490],[461,233],[174,372],[421,36],[393,381],[415,22],[423,458],[66,467],[75,242],[325,269],[194,397],[59,135],[318,376],[185,52],[392,207],[157,403],[197,78],[399,482],[286,152],[205,303],[168,242],[360,68],[323,41],[291,101],[279,56],[60,47],[395,78],[211,416],[371,303],[431,441],[225,207],[352,422],[30,84],[192,64],[23,115],[97,310],[179,439],[337,414],[324,127],[318,10],[238,299],[352,90],[277,259],[181,68],[38,347],[125,134],[415,84],[277,445],[417,27],[61,472],[99,379],[153,34],[212,242],[240,471],[317,146],[21,19],[284,68],[478,402],[461,361],[26,140],[218,493],[2,377],[424,402],[395,117],[87,147],[298,29],[43,402],[86,480],[238,122],[65,336],[315,36],[167,490],[343,377],[104,426],[291,319],[279,450],[392,68],[166,95],[165,293],[183,31],[139,500],[173,175],[491,101],[133,17],[30,146],[183,414],[436,281],[195,346],[447,402],[261,312],[436,134],[79,207],[366,319],[382,229],[285,204],[141,346],[166,331],[290,486],[253,440],[119,33],[82,41],[166,486],[183,138],[243,329],[237,62],[107,138],[125,80],[289,376],[156,1],[116,239],[173,266],[301,498],[139,224],[328,340],[51,184],[191,91],[73,386],[218,25],[268,432],[355,396],[203,432],[227,52],[114,22],[103,204],[267,331],[279,83],[126,132],[444,78],[85,249],[218,89],[220,48],[160,236],[250,53],[153,80],[481,426],[166,171],[51,482],[220,278],[392,176],[457,235],[191,416],[258,303],[179,442],[126,379],[154,338],[170,386],[279,439],[267,235],[333,275],[263,430],[314,105],[151,312],[280,6],[254,397],[174,235],[316,467],[193,95],[333,83],[46,486],[92,500],[371,472],[248,239],[380,434],[481,135],[218,232],[470,416],[225,132],[304,230],[453,6],[237,230],[353,381],[461,27],[385,282],[433,471],[473,13],[116,327],[475,115],[70,134],[167,495],[208,434],[67,439],[54,377],[205,321],[478,492],[304,231],[173,214],[161,467],[8,303],[366,53],[162,39],[216,379],[318,293],[3,105],[298,228],[464,299],[49,89],[391,452],[470,53],[203,448],[40,405],[87,409],[447,350],[40,303],[353,228],[311,403],[188,375],[359,81],[388,463],[26,71],[216,344],[241,435],[75,131],[437,297],[222,442],[400,426],[363,377],[251,405],[328,347],[343,283],[155,492],[284,435],[173,495],[368,71],[295,35],[298,312],[301,50],[368,351],[436,303],[220,122],[339,259],[292,350],[257,432],[153,276],[465,53],[130,312],[457,412],[465,105],[478,351],[302,313],[161,68],[159,435],[243,71],[355,321],[398,147],[208,242],[157,452],[360,122],[384,293],[401,416],[174,102],[123,405],[92,17],[370,89],[393,375],[433,450],[220,53],[373,422],[114,204],[126,434],[374,377],[424,113],[108,406],[139,430],[137,490],[28,389],[323,500],[385,132],[470,500],[161,469],[9,275],[251,383],[166,449],[309,50]]))
# print(magnificentSets(41, [[15,9],[18,28],[16,23],[23,40],[4,10],[40,27],[32,35],[26,29],[29,38],[23,35],[15,10],[2,40],[16,24],[41,28],[12,6],[39,38],[6,10],[41,4],[21,41],[26,41],[20,17],[17,21],[24,5],[17,1],[6,27],[31,6],[16,7],[38,8]]))
print(magnificentSets(500, [[273,319],[260,181],[266,131],[314,265],[20,107],[202,357],[290,103],[421,203],[374,141],[252,241],[93,183],[252,209],[268,112],[399,84],[302,72],[434,243],[18,72],[421,400],[361,38],[51,262],[234,261],[218,457],[293,115],[398,362],[109,81],[349,72],[478,238],[275,91],[221,157],[435,364],[93,460],[192,288],[411,310],[208,185],[474,107],[464,310],[435,348],[297,346],[60,83],[167,458],[345,463],[349,486],[363,197],[139,319],[169,226],[338,467],[121,77],[130,205],[53,315],[270,283],[202,316],[418,369],[372,78],[55,375],[337,259],[462,283],[221,203],[447,181],[184,1],[99,115],[295,178],[388,460],[222,292],[139,98],[363,395],[88,214],[407,7],[189,395],[184,283],[95,446],[433,362],[480,484],[89,106],[159,413],[398,280],[495,161],[421,225],[332,48],[248,232],[422,241],[235,331],[169,315],[104,48],[427,106],[462,262],[497,274],[258,393],[330,406],[100,64],[404,178],[272,437],[23,203],[167,369],[354,226],[235,396],[96,308],[169,378],[278,244],[473,81],[201,194],[9,307],[464,206],[63,148],[229,120],[444,445],[249,72],[20,150],[493,479],[6,216],[234,283],[139,224],[470,484],[312,370],[390,238],[297,83],[373,2],[130,482],[440,261],[251,128],[365,286],[129,138],[294,230],[347,406],[407,179],[470,58],[456,487],[300,383],[278,448],[341,371],[367,396],[470,98],[452,393],[351,140],[335,454],[61,371],[211,76],[196,484],[95,191],[258,230],[10,101],[386,76],[305,313],[99,466],[338,226],[421,164],[453,492],[391,392],[388,327],[26,148],[269,446],[162,163],[67,384],[305,223],[229,85],[427,105],[416,216],[67,157],[470,313],[343,265],[377,487],[109,397],[237,46],[480,319],[355,397],[277,83],[245,400],[309,445],[314,315],[456,410],[398,408],[23,261],[255,472],[386,461],[322,204],[398,45],[15,285],[202,19],[147,19],[358,185],[208,241],[126,146],[287,144],[73,262],[485,310],[421,122],[278,216],[470,451],[301,137],[444,171],[121,463],[147,214],[219,177],[338,106],[202,483],[234,459],[468,181],[361,114],[13,310],[347,194],[154,52],[330,368],[394,123],[414,164],[154,321],[390,2],[60,262],[380,36],[402,256],[314,78],[340,177],[343,66],[162,177],[276,393],[73,283],[195,352],[377,140],[175,72],[407,425],[323,288],[190,142],[418,385],[186,163],[270,157],[386,362],[469,342],[358,405],[497,5],[335,395],[485,425],[452,203],[287,213],[434,37],[423,5],[3,165],[70,254],[28,370],[330,400],[322,115],[429,439],[323,368],[407,280],[444,36],[335,329],[270,19],[367,205],[220,250],[433,499],[162,466],[13,123],[211,123]]))